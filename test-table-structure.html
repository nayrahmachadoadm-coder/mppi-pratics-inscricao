<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Estrutura Tabela</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Teste Estrutura da Tabela Inscricoes</h1>
    <button onclick="testTableStructure()">Testar Estrutura</button>
    <button onclick="testMinimalInsert()">Testar Inser√ß√£o M√≠nima</button>
    <div id="result"></div>

    <script>
        const supabaseUrl = 'https://ljbxctmywdpsfmjvmlmh.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxqYnhjdG15d2Rwc2ZtanZtbG1oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MzY5MTYsImV4cCI6MjA3MzUxMjkxNn0.7A5d6_TvKyRV2Csqf43hkXzvaCd-5b2tKKlAU4ucyaY';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function testTableStructure() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testando estrutura da tabela...</p>';

            try {
                // Primeiro, vamos tentar fazer uma consulta simples para ver se a tabela existe
                console.log('üîç Testando se a tabela existe...');
                const { data: existsData, error: existsError } = await supabase
                    .from('inscricoes')
                    .select('*')
                    .limit(1);

                if (existsError) {
                    console.error('‚ùå Erro ao verificar tabela:', existsError);
                    resultDiv.innerHTML = `
                        <h3>‚ùå Erro ao verificar tabela:</h3>
                        <pre>${JSON.stringify(existsError, null, 2)}</pre>
                    `;
                    return;
                }

                console.log('‚úÖ Tabela existe, dados:', existsData);
                resultDiv.innerHTML = `
                    <h3>‚úÖ Tabela existe!</h3>
                    <p>Registros encontrados: ${existsData.length}</p>
                    <pre>${JSON.stringify(existsData, null, 2)}</pre>
                `;

            } catch (error) {
                console.error('‚ùå Erro inesperado:', error);
                resultDiv.innerHTML = `
                    <h3>‚ùå Erro inesperado:</h3>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                `;
            }
        }

        async function testMinimalInsert() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testando inser√ß√£o m√≠nima...</p>';

            try {
                // Teste com dados m√≠nimos obrigat√≥rios
                const testData = {
                    nome_completo: 'Teste Estrutura',
                    cargo_funcao: 'Teste',
                    email_institucional: 'teste@teste.com',
                    telefone: '123456789',
                    lotacao: 'Teste',
                    titulo_iniciativa: 'Teste',
                    area_atuacao: 'Teste',
                    data_inicio: '2024-01-01',
                    publico_alvo: 'Teste',
                    descricao_iniciativa: 'Teste',
                    objetivos: 'Teste',
                    metodologia: 'Teste',
                    principais_resultados: 'Teste',
                    cooperacao: 'Teste',
                    inovacao: 'Teste',
                    resolutividade: 'Teste',
                    impacto_social: 'Teste',
                    alinhamento_ods: 'Teste',
                    replicabilidade: 'Teste',
                    participou_edicoes_anteriores: false,
                    foi_vencedor_anterior: false,
                    declaracao: true
                };

                console.log('üß™ Testando inser√ß√£o com dados m√≠nimos...');
                const { data: insertData, error: insertError } = await supabase
                    .from('inscricoes')
                    .insert([testData])
                    .select();

                if (insertError) {
                    console.error('‚ùå Erro na inser√ß√£o:', insertError);
                    resultDiv.innerHTML = `
                        <h3>‚ùå Erro na inser√ß√£o:</h3>
                        <pre>${JSON.stringify(insertError, null, 2)}</pre>
                        <h4>Dados que tentamos inserir:</h4>
                        <pre>${JSON.stringify(testData, null, 2)}</pre>
                    `;
                } else {
                    console.log('‚úÖ Inser√ß√£o bem-sucedida:', insertData);
                    resultDiv.innerHTML = `
                        <h3>‚úÖ Inser√ß√£o bem-sucedida!</h3>
                        <p>Dados inseridos:</p>
                        <pre>${JSON.stringify(insertData, null, 2)}</pre>
                    `;
                }

            } catch (error) {
                console.error('‚ùå Erro inesperado:', error);
                resultDiv.innerHTML = `
                    <h3>‚ùå Erro inesperado:</h3>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                `;
            }
        }
    </script>
</body>
</html>